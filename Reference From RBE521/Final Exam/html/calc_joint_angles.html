<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB 2022a"><title>Untitled</title><style type="text/css">.rtcContent { padding: 30px; } .CodeBlock { background-color: #F5F5F5; margin: 10px 0 10px 0; }
.S0 { border-left: 1px solid rgb(191, 191, 191); border-right: 1px solid rgb(191, 191, 191); border-top: 1px solid rgb(191, 191, 191); border-bottom: 0px none rgb(33, 33, 33); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S1 { border-left: 1px solid rgb(191, 191, 191); border-right: 1px solid rgb(191, 191, 191); border-top: 0px none rgb(33, 33, 33); border-bottom: 0px none rgb(33, 33, 33); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S2 { border-left: 1px solid rgb(191, 191, 191); border-right: 1px solid rgb(191, 191, 191); border-top: 0px none rgb(33, 33, 33); border-bottom: 1px solid rgb(191, 191, 191); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }</style></head><body><div class = rtcContent><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S0'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">function </span><span >joint_angles = calc_joint_angles(leg_number, x_pos, z_pos)</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Initialize known values</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    leg_lengths = [0, 0.050, 0.100]; </span><span style="color: rgb(0, 128, 19);">% m</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    body_height = 0.1; </span><span style="color: rgb(0, 128, 19);">% m</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    liftoff_height = 0.005; </span><span style="color: rgb(0, 128, 19);">% m</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    body_l = 0.4; </span><span style="color: rgb(0, 128, 19);">% m</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    body_w = 0.2; </span><span style="color: rgb(0, 128, 19);">% m</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    body_h = 0.1; </span><span style="color: rgb(0, 128, 19);">% m</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    num_timesteps = size(x_pos,2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Initialize blank values</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    alpha = zeros(1,num_timesteps); </span><span style="color: rgb(0, 128, 19);">% -90 &lt;= alpha &lt;= 90</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    beta = zeros(1,num_timesteps); </span><span style="color: rgb(0, 128, 19);">% -30 &lt;= beta &lt;= 90</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    gamma = zeros(1,num_timesteps); </span><span style="color: rgb(0, 128, 19);">% 0 &lt;= gamma &lt;= 120</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Calculate y linear trajectory appropriate for the leg</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% based on the leg's side of the body (left or right)</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">%y_pos_from_joint = ((-1)^(leg_number+1)) * (leg_lengths(2) * cosd(asind(x_pos(1) / leg_lengths(2))));</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    y_pos_from_joint = ((-1)^(leg_number+1)) * 0.047;</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    y_pos = y_pos_from_joint * ones(1,num_timesteps);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">%y_pos_from_body_origin = ((-1)^(leg_number+1)) * ((body_w / 2) + leg_lengths(2) * cosd(asind(x_pos(1) / leg_lengths(2))));</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Calculate hip angles, 0 deg is outwards from chassis</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Left legs transfer from +alpha to -alpha</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Right legs transfer from -alpha to +alpha</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    alpha = atan2d(y_pos,x_pos) + ((-1)^(leg_number)) * 90; </span><span style="color: rgb(0, 128, 19);">% hip joint angles</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Calculate knee and ankle joint angles</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(0, 128, 19);">% Knee joint is same point as hip joint</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    h = body_height * ones(1,num_timesteps);</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    Li = [(-x_pos); (-y_pos); (h - z_pos)]; </span><span style="color: rgb(0, 128, 19);">% vector from foot to knee joint (and hip too)</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(14, 0, 255);">for </span><span >i = 1:num_timesteps </span><span style="color: rgb(0, 128, 19);">% for each time step</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >        li(i) = norm(Li(:,i),2); </span><span style="color: rgb(0, 128, 19);">% magnitude of vector from foot to knee joint</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >        </span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >        phi(i) = 0; </span><span style="color: rgb(0, 128, 19);">% hip and knee are on top of heachother, so asind((h_h - h_k)/2) = 0</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >        rho(i) = asind(Li(3,i) / li(i));</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >        </span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >        </span><span style="color: rgb(0, 128, 19);">% Knee joint angles, 0 is horizontally out from robot, + is up</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >        beta(i) = loc(leg_lengths(2), li(i), leg_lengths(3)) - (rho(i) + phi(i));</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >        </span><span style="color: rgb(0, 128, 19);">% Ankle joint angles, 90 is straight down, + is into robot</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >        gamma(i) = 180 - loc(leg_lengths(2), leg_lengths(3), li(i));</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    </span><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S1'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S1'><span style="white-space: pre"><span >    joint_angles = real([alpha; beta; gamma]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre"><span style="color: rgb(14, 0, 255);">end</span></span></div></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
function joint_angles = calc_joint_angles(leg_number, x_pos, z_pos)
    % Initialize known values
    leg_lengths = [0, 0.050, 0.100]; % m
    body_height = 0.1; % m
    liftoff_height = 0.005; % m
    body_l = 0.4; % m
    body_w = 0.2; % m
    body_h = 0.1; % m
    num_timesteps = size(x_pos,2);

    % Initialize blank values
    alpha = zeros(1,num_timesteps); % -90 <= alpha <= 90
    beta = zeros(1,num_timesteps); % -30 <= beta <= 90
    gamma = zeros(1,num_timesteps); % 0 <= gamma <= 120
    
    % Calculate y linear trajectory appropriate for the leg
    % based on the leg's side of the body (left or right)
    %y_pos_from_joint = ((-1)^(leg_number+1)) * (leg_lengths(2) * cosd(asind(x_pos(1) / leg_lengths(2))));
    y_pos_from_joint = ((-1)^(leg_number+1)) * 0.047;
    y_pos = y_pos_from_joint * ones(1,num_timesteps);
    %y_pos_from_body_origin = ((-1)^(leg_number+1)) * ((body_w / 2) + leg_lengths(2) * cosd(asind(x_pos(1) / leg_lengths(2))));


    % Calculate hip angles, 0 deg is outwards from chassis
    % Left legs transfer from +alpha to -alpha
    % Right legs transfer from -alpha to +alpha
    alpha = atan2d(y_pos,x_pos) + ((-1)^(leg_number)) * 90; % hip joint angles

    % Calculate knee and ankle joint angles
    % Knee joint is same point as hip joint
    h = body_height * ones(1,num_timesteps);
    Li = [(-x_pos); (-y_pos); (h - z_pos)]; % vector from foot to knee joint (and hip too)

    for i = 1:num_timesteps % for each time step
        li(i) = norm(Li(:,i),2); % magnitude of vector from foot to knee joint
        
        phi(i) = 0; % hip and knee are on top of heachother, so asind((h_h - h_k)/2) = 0
        rho(i) = asind(Li(3,i) / li(i));
        
        % Knee joint angles, 0 is horizontally out from robot, + is up
        beta(i) = loc(leg_lengths(2), li(i), leg_lengths(3)) - (rho(i) + phi(i));

        % Ankle joint angles, 90 is straight down, + is into robot
        gamma(i) = 180 - loc(leg_lengths(2), leg_lengths(3), li(i));
    end

    joint_angles = real([alpha; beta; gamma]);
end
##### SOURCE END #####
-->
</div></body></html>